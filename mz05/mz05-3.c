#include <string.h> // для strlen
#include <stddef.h> // для size_t

/**
 * @brief Разбирает строку прав доступа формата "rwxrwxrwx" и возвращает целочисленное представление.
 * 
 * @param str Входная строка с правами доступа (9 символов). Может быть NULL.
 * @return Соответствующее числовое значение прав доступа (9-битное целое).
 *         Возвращает -1, если строка некорректная:
 *         - str является NULL
 *         - длина строки не равна 9
 *         - строка содержит недопустимые символы или символы в неправильной позиции.
 */
int parse_rwx_permissions(const char *str) {
    // Строка-образец, как указано в задании.
    const char *template_str = "rwxrwxrwx";
    
    // Вычисляем длину образца на этапе компиляции, чтобы избежать "магических чисел", как 9.
    // sizeof("...") включает нулевой терминатор, поэтому вычитаем 1.
    const size_t template_len = sizeof("rwxrwxrwx") - 1;

    // 1. Проверка на NULL.
    if (str == NULL) {
        return -1;
    }

    // 2. Проверка длины строки. Это единственное разрешенное использование strlen.
    if (strlen(str) != template_len) {
        return -1;
    }

    int permissions = 0;

    // 3. Проходим по всем 9 символам строки.
    for (size_t i = 0; i < template_len; ++i) {
        char current_char = str[i];
        char template_char = template_str[i];

        // 4. Проверяем корректность символа в данной позиции.
        // Символ должен либо совпадать с образцом (r, w, или x), либо быть '-'.
        if (current_char == template_char) {
            // Если символ совпадает с образцом, значит право доступа установлено.
            // Устанавливаем соответствующий бит в результирующем числе.
            // Биты нумеруются справа налево (от 0 до 8), поэтому для i=0 нужен бит 8, для i=8 - бит 0.
            // (template_len - 1 - i) дает нужную позицию бита: (8 - i).
            permissions |= (1 << ((template_len - 1) - i));
        } else if (current_char == '-') {
            // Если символ '-', право доступа не установлено. Ничего не делаем, бит остается 0.
        } else {
            // Если символ не совпадает с образцом и не является '-', значит строка некорректна.
            return -1;
        }
    }

    // 5. Возвращаем собранное значение прав доступа.
    return permissions;
}

